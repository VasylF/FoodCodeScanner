# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the master branch
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

  # Allows you to run this workflow manually from the Actions tab

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  setup:
    runs-on: macos-11
    steps:
    - uses: actions/checkout@v2
    - uses: n1hility/cancel-previous-runs@v2
      with:
        token: ${{ secrets.MANUAL_ACTION_TOKEN }}


    - name: Spell check
      run: |
        brew install mint
        shell:
        YELLOW='\033[1;33m'
NOCOLOR='\033[0m'
RED='\033[031m'

OUT_PUT_FILE_NAME=temp_file

rm $OUT_PUT_FILE_NAME

touch $OUT_PUT_FILE_NAME

echo "false" > $OUT_PUT_FILE_NAME

function processOutPut() {
  while read -r line
   do
     if [[ $line = *"Test"* ]]; then
       echo "${YELLOW}$line${NOCOLOR}"
     elif [[ $line == *"warning"* ]]; then
       echo "${RED}$line${NOCOLOR}"
       echo "true" > $1
     else
       echo "$line"
     fi
  done
}

export PATH=~/.mint/bin:$PATH

mint install ezura/spell-checker-for-swift@5.3.0

typokana | processOutPut $OUT_PUT_FILE_NAME

SHOULD_FAIL=$(cat $OUT_PUT_FILE_NAME)

rm $OUT_PUT_FILE_NAME

if [ "$SHOULD_FAIL" = true ]; then
  exit 1
fi
